{"ts":1377363321374,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\r\n/**\r\n * Module dependencies.\r\n */\r\n\r\nvar express = require('express')\r\n  , routes = require('./routes')\r\n  , http = require('http')\r\n  , path = require('path')\r\n  , socketio = require('socket.io');\r\n\r\nvar app = express();\r\n\r\n\r\n\r\n// all environments\r\napp.set('port', process.env.PORT || 3000);\r\napp.set('ip', process.env.IP);\r\napp.set('views', __dirname + '/views');\r\napp.set('view engine', 'ejs');\r\napp.use(express.favicon());\r\napp.use(express.logger('dev'));\r\napp.use(express.bodyParser());\r\napp.use(express.methodOverride());\r\napp.use(express.static(path.join(__dirname, 'public')));\r\napp.use(express.cookieParser());\r\napp.use(express.session({secret: 'svtabyrki4q786as37c785ta8vi56aiw4i8w467acv'}));\r\napp.use(app.router);\r\n\r\n// development only\r\nif ('development' == app.get('env')) {\r\n  app.use(express.errorHandler());\r\n}\r\n\r\n//get action\r\napp.get('/', routes.index);\r\napp.get('/index2', routes.index2);\r\napp.get('/list', routes.list);\r\napp.get('/broadcast', routes.broadcast);\r\napp.get('/mobile_broadcast', routes.mobile_broadcast);\r\napp.get('/recommend', routes.recommend);\r\napp.get('/fullScreen', routes.mobile_broadcast);\r\napp.get('/joinMember', routes.joinMember);\r\n\r\n//post action\r\napp.post('/login', routes.login);\r\napp.post('/logout', routes.logout);\r\n\r\n//지수 요청\r\napp.post('/appLogin', routes.appLogin);   //로그인\r\napp.post('/appJoin', routes.appJoin);    //회원가입\r\napp.post('/appRoomList', routes.appRoomList);    //방목록\r\napp.post('/appMakeRoom', routes.appMakeRoom);    //방만들기\r\napp.post('/appDeleteRoom', routes.appDeleteRoom);    //방삭제\r\napp.post('/appSearchRoom', routes.appSearchRoom);    //방만들기\r\napp.post('/appCheckRecommend', routes.appCheckRecommend);    //추천 여부체크\r\napp.post('/appInsertRecommend', routes.appInsertRecommend);    //추천 테이블삽입\r\napp.post('/appIncreaseRecommend', routes.appIncreaseRecommend);    //추천수 +1\r\napp.post('/appSearchRoom', routes.appSearchRoom);    //방만들기\r\n\r\nvar server = http.createServer(app);\r\n\r\nvar roomCount = new Array();\r\n\r\nvar io = socketio.listen(server);\r\nio.set('log level', 2);\r\nio.sockets.on('connection', function(socket){    \r\n    socket.on('message', function(data){\r\n        console.log(data);\r\n        if(data != \"connect\"){\r\n            socket.get('room', function(error, room){\r\n                io.sockets.in(room).emit('message', data);\r\n            });\r\n        } \r\n    });\r\n    socket.on('join', function(data){\r\n        socket.join(data);\r\n        socket.set('room', data);\r\n        if(typeof roomCount[data] == 'undefined'){\r\n            roomCount[data] = 0;\r\n        }\r\n        roomCount[data]++;\r\n        socket.get('room', function(error, room){\r\n            io.sockets.in(room).emit('roomCount', roomCount[data]);\r\n        });\r\n    });\r\n    socket.on('disconnect', function(){\r\n        socket.get('room', function(error, room){\r\n            if(roomCount[room] <= 0){\r\n                roomCount[room] = 0;\r\n            }\r\n            else{\r\n                roomCount[room]--;\r\n            }\r\n            io.sockets.in(room).emit('roomCount', roomCount[room]);\r\n        });\r\n    });\r\n});\r\n\r\nserver.listen(app.get('port'), app.get('ip'), function(){\r\n  console.log('Express server listening on port ' + app.get('port'));\r\n});"]],"start1":0,"start2":0,"length1":0,"length2":3188}]],"length":3188}
{"contributors":[],"silentsave":false,"ts":1377363520308,"patch":[[{"diffs":[[0,"   });\r\n"],[1,"    socket.on('makeRoom', function(){\r\n        socket.get('room', function(error, room){\r\n            if(roomCount[room] <= 0){\r\n                roomCount[room] = 0;\r\n            }\r\n            else{\r\n                roomCount[room]--;\r\n            }\r\n            io.sockets.in(room).emit('roomCount', roomCount[room]);\r\n        });\r\n    });\r\n"],[0,"});\r\n\r\ns"]],"start1":3040,"start2":3040,"length1":16,"length2":359}]],"length":3531,"saved":false}
{"ts":1377363545406,"patch":[[{"diffs":[[0,"    "],[-1,"socket.get('room', function(error, room){\r\n            if(roomCount[room] <= 0){\r\n                roomCount[room] = 0;\r\n            }\r\n            else{\r\n                roomCount[room]--;\r\n            }\r\n            io.sockets.in(room).emit('roomCount', roomCount[room]);\r\n        });"],[0,"\r\n  "]],"start1":3091,"start2":3091,"length1":293,"length2":8}]],"length":3246,"saved":false}
{"ts":1377363631438,"patch":[[{"diffs":[[0,"Room', function("],[1,"data"],[0,"){\r\n        \r\n  "]],"start1":3067,"start2":3067,"length1":32,"length2":36},{"diffs":[[0,"){\r\n        "],[1,"io.sockets.emit('makeRoom', data);"],[0,"\r\n    });\r\n}"]],"start1":3087,"start2":3087,"length1":24,"length2":58}]],"length":3284,"saved":false}
{"ts":1377376149919,"patch":[[{"diffs":[[0,"   });\r\n    "],[-1,"socke"],[1,"routes.eventEmi"],[0,"t.on('makeRo"]],"start1":3040,"start2":3040,"length1":29,"length2":39},{"diffs":[[0,"Room', function("],[-1,"data"],[0,"){\r\n        io.s"]],"start1":3077,"start2":3077,"length1":36,"length2":32},{"diffs":[[0,"t('makeRoom'"],[-1,", data"],[0,");\r\n    });\r"]],"start1":3119,"start2":3119,"length1":30,"length2":24}]],"length":3284,"saved":false}
{"ts":1377376159281,"patch":[[{"diffs":[[0,"', function(){\r\n"],[1,"        console.log('test');\r\n"],[0,"        io.socke"]],"start1":3081,"start2":3081,"length1":32,"length2":62}]],"length":3314,"saved":false}
{"ts":1377376223957,"patch":[[{"diffs":[[0,");\r\n});\r"],[1,"\n        console.log('test');\r"],[0,"\n\r\nserve"]],"start1":3170,"start2":3170,"length1":16,"length2":46}]],"length":3344,"saved":false}
{"ts":1377376251774,"patch":[[{"diffs":[[0,"});\r"],[-1,"\n        console.log('test');\r"],[0,"\n\r\ns"]],"start1":3174,"start2":3174,"length1":38,"length2":8}]],"length":3314,"saved":false}
{"ts":1377376341498,"patch":[[{"diffs":[[0,");\r\n"],[-1,"    routes.eventEmit.on('makeRoom', function(){\r\n        console.log('test');\r\n        io.sockets.emit('makeRoom');\r\n    });\r\n"],[0,"});\r"]],"start1":3044,"start2":3044,"length1":134,"length2":8}]],"length":3188,"saved":false}
{"ts":1377376359517,"patch":[[{"diffs":[[0,"목록\r\n"],[-1,"app.post('/appMakeRoom', routes.appMakeRoom);    //방만들기\r\n"],[0,"app."]],"start1":1427,"start2":1427,"length1":65,"length2":8}]],"length":3131,"saved":false}
{"ts":1377376360770,"patch":[[{"diffs":[[0,"   });\r\n"],[1,"    \r\napp.post('/appMakeRoom', routes.appMakeRoom);    //방만들기\r\n"],[0,"});\r\n\r\ns"]],"start1":2983,"start2":2983,"length1":16,"length2":79}]],"length":3194,"saved":false}
{"ts":1377376465383,"patch":[[{"diffs":[[0,"\r\n    \r\n"],[1,"    "],[0,"app.post"]],"start1":2989,"start2":2989,"length1":16,"length2":20},{"diffs":[[0,"ppMakeRoom',"],[1," function(req, res, next){\r\n        io.sockets.emit('makeRoom');\r\n        next();\r\n    },"],[0," routes.appM"]],"start1":3013,"start2":3013,"length1":24,"length2":113}]],"length":3287,"saved":false}
{"ts":1377376476085,"patch":[[{"diffs":[[0,"es, next){\r\n"],[1,"        console.log(\"ok\");\r\n"],[0,"        io.s"]],"start1":3041,"start2":3041,"length1":24,"length2":52}]],"length":3315,"saved":false}
{"ts":1377376514430,"patch":[[{"diffs":[[0,"om',"],[-1," function(req, res, next){\r\n        console.log(\"ok\");\r\n        io.sockets.emit('makeRoom');\r\n        next();\r\n    },"],[0," rou"]],"start1":3021,"start2":3021,"length1":125,"length2":8}]],"length":3198,"saved":false}
{"ts":1377376515661,"patch":[[{"diffs":[[0,"ppMakeRoom',"],[-1," "],[0,"routes.appMa"]],"start1":3013,"start2":3013,"length1":25,"length2":24}]],"length":3197,"saved":false}
{"contributors":[],"silentsave":false,"ts":1377376657956,"patch":[[{"diffs":[[0,".appSearchRoom);"],[1,"    //방찾기\r\n    app.post('/appMakeRoom',routes.appMakeRoom);"],[0,"    //방만들기\r\napp."]],"start1":1524,"start2":1524,"length1":32,"length2":91},{"diffs":[[0,");\r\n"],[-1,"    \r\n    app.post('/appMakeRoom',routes.appMakeRoom);    //방만들기\r\n"],[0,"});\r"]],"start1":3046,"start2":3046,"length1":74,"length2":8}]],"length":3190,"saved":false}
{"ts":1377376661117,"patch":[[{"diffs":[[0," //방찾기\r\n"],[-1,"    "],[0,"app.post"]],"start1":1543,"start2":1543,"length1":20,"length2":16}]],"length":3186,"saved":false}
{"ts":1377376669915,"patch":[[{"diffs":[[0,"keRoom',"],[1," "],[0,"routes.a"]],"start1":1567,"start2":1567,"length1":16,"length2":17}]],"length":3187,"saved":false}
{"ts":1377376680171,"patch":[[{"diffs":[[0,"ut);\r\n\r\n"],[1,"var io = socketio.listen(server);\r\n\r\n"],[0,"//지수 요청\r"]],"start1":1260,"start2":1260,"length1":16,"length2":53},{"diffs":[[0,"\r\n\r\n"],[-1,"var io = socketio.listen(server);\r\n"],[0,"io.s"]],"start1":2000,"start2":2000,"length1":43,"length2":8}]],"length":3189,"saved":false}
{"ts":1377376685432,"patch":[[{"diffs":[[0,"\r\n\r\n"],[-1,"var io = socketio.listen(server);\r\n"],[0,"\r\n//"]],"start1":1264,"start2":1264,"length1":43,"length2":8},{"diffs":[[0,"y();\r\n\r\n"],[1,"var io = socketio.listen(server);\r\n"],[0,"io.set('"]],"start1":1961,"start2":1961,"length1":16,"length2":51}]],"length":3189,"saved":false}
{"ts":1377376721556,"patch":[[{"diffs":[[0,"찾기\r\n"],[-1,"app.post('/appMakeRoom', routes.appMakeRoom);    //방만들기\r\n"],[0,"app."]],"start1":1549,"start2":1549,"length1":65,"length2":8},{"diffs":[[0,"evel', 2);\r\n"],[1,"\r\napp.post('/appMakeRoom', function(reqest, response, next){\r\n    console.log(\"test\");\r\n    next();\r\n}, routes.appMakeRoom);    //방만들기\r\n\r\n"],[0,"io.sockets.o"]],"start1":1960,"start2":1960,"length1":24,"length2":162}]],"length":3270,"saved":false}
{"ts":1377376809309,"patch":[[{"diffs":[[0,"g(\"test\");\r\n"],[1,"    io.sockets.emit('makeRoom');\r\n"],[0,"    next();\r"]],"start1":2048,"start2":2048,"length1":24,"length2":58}]],"length":3304,"saved":false}
{"ts":1377377120205,"patch":[[{"diffs":[[0,"om',"],[-1," function(reqest, response, next){\r\n    console.log(\"test\");\r\n    io.sockets.emit('makeRoom');\r\n    next();\r\n},"],[0," rou"]],"start1":1994,"start2":1994,"length1":119,"length2":8}]],"length":3193,"saved":false}
{"ts":1377377130384,"patch":[[{"diffs":[[0," //방찾기\r\n"],[1,"app.post('/appMakeRoom', routes.appMakeRoom);    //방만들기\r\n"],[0,"app.post"]],"start1":1545,"start2":1545,"length1":16,"length2":73},{"diffs":[[0,"천 여부체크\r\n"],[-1,""],[0,"app.post"]],"start1":1674,"start2":1674,"length1":16,"length2":16},{"diffs":[[0," +1\r"],[-1,"\napp.post('/appSearchRoom', routes.appSearchRoom);    //방만들기\r"],[0,"\n\r\nv"]],"start1":1829,"start2":1829,"length1":69,"length2":8},{"diffs":[[0,"\r\n\r\n"],[-1,"app.post('/appMakeRoom', routes.appMakeRoom);    //방만들기\r\n"],[0,"\r\nio"]],"start1":1966,"start2":1966,"length1":65,"length2":8}]],"length":3132,"saved":false}
{"ts":1377377191831,"patch":[[{"diffs":[[0,"체크\r\n"],[-1,"app.post('/appInsertRecommend', routes.appInsertRecommend);    //추천 테이블삽입\r\n"],[0,"app."]],"start1":1678,"start2":1678,"length1":83,"length2":8}]],"length":3057,"saved":false}
{"ts":1377378247142,"patch":[[{"diffs":[[0,"ion(){\r\n"],[1,"  "],[0,"  consol"]],"start1":2975,"start2":2975,"length1":16,"length2":18}]],"length":3059,"saved":false}
{"ts":1377378370231,"patch":[[{"diffs":[[0,");\r\n\r\n\r\n"],[1,"var io = socketio.listen(server);\r\nio.set('log level', 2);\r\n"],[0,"//지수 요청\r"]],"start1":1262,"start2":1262,"length1":16,"length2":76},{"diffs":[[0,"ppMakeRoom',"],[1," function(req,res,next){console.log(\"test\");io.sockets.emit('makeRoom');next();},"],[0," routes.appM"]],"start1":1625,"start2":1625,"length1":24,"length2":105},{"diffs":[[0,"\r\n\r\n"],[-1,"var io = socketio.listen(server);\r\nio.set('log level', 2);\r\n"],[0,"\r\n\r\n"]],"start1":1970,"start2":1970,"length1":68,"length2":8}]],"length":3140,"saved":false}
{"ts":1377378550410,"patch":[[{"diffs":[[0,"\"test\");"],[-1,"io.socket"],[1,"proces"],[0,"s.emit('"]],"start1":1673,"start2":1673,"length1":25,"length2":22},{"diffs":[[0,"   });\r\n"],[1,"    process.on('makeRoom', function(){\r\n        io.sockets.emit('makeRoom');\r\n    });\r\n"],[0,"});\r\n\r\ns"]],"start1":2987,"start2":2987,"length1":16,"length2":103}]],"length":3224,"saved":false}
{"ts":1377378595951,"patch":[[{"diffs":[[0,"om',"],[-1," function(req,res,next){console.log(\"test\");process.emit('makeRoom');next();},"],[0," rou"]],"start1":1633,"start2":1633,"length1":86,"length2":8}]],"length":3146,"saved":false}
{"ts":1377378605603,"patch":[[{"diffs":[[0,"ppMakeRoom',"],[1," function(reqest,response,next){console.log(\"test\");process.emit('makeRoom');next();},"],[0," routes.appM"]],"start1":1625,"start2":1625,"length1":24,"length2":110}]],"length":3232,"saved":false}
{"ts":1377378611349,"patch":[[{"diffs":[[0,"\r\n\r\n"],[-1,"var io = socketio.listen(server);\r\nio.set('log level', 2);\r\n"],[0,"//지수"]],"start1":1266,"start2":1266,"length1":68,"length2":8},{"diffs":[[0,"Array();\r\n\r\n"],[1,"\r\nvar io = socketio.listen(server);\r\nio.set('log level', 2);"],[0,"\r\n\r\nio.socke"]],"start1":1907,"start2":1907,"length1":24,"length2":84}]],"length":3232,"saved":false}
{"ts":1377378616052,"patch":[[{"diffs":[[0,"m', "],[-1,"function(reqest,response,next){console.log(\"test\");process.emit('makeRoom');next();},"],[0," rou"]],"start1":1574,"start2":1574,"length1":93,"length2":8}]],"length":3147,"saved":false}
{"ts":1377378617995,"patch":[[{"diffs":[[0,"keRoom',"],[-1," "],[0," routes."]],"start1":1569,"start2":1569,"length1":17,"length2":16}]],"length":3146,"saved":false}
{"ts":1377378627450,"patch":[[{"diffs":[[0,"ppMakeRoom',"],[1,"function(reqest,response,next){console.log(\"test\");process.emit('makeRoom');next();}"],[0," routes.appM"]],"start1":1565,"start2":1565,"length1":24,"length2":108}]],"length":3230,"saved":false}
{"ts":1377378630447,"patch":[[{"diffs":[[0,"next();}"],[1,","],[0," routes."]],"start1":1653,"start2":1653,"length1":16,"length2":17}]],"length":3231,"saved":false}
{"ts":1377378674700,"patch":[[{"diffs":[[0,"xt){"],[-1,"console.log(\"test\");"],[0,"proc"]],"start1":1604,"start2":1604,"length1":28,"length2":8}]],"length":3211,"saved":false}
{"ts":1377378824857,"patch":[[{"diffs":[[0,"DeleteRoom',"],[1,"function(reqest,response,next){process.emit('makeRoom');next();},"],[0," routes.appD"]],"start1":1447,"start2":1447,"length1":24,"length2":89}]],"length":3276,"saved":false}
{"ts":1377379074257,"patch":[[{"diffs":[[0,"s();\r\n\r\n"],[1,"\r\nprocess.setMaxListeners(0);"],[0,"\r\n\r\n// a"]],"start1":219,"start2":219,"length1":16,"length2":45}]],"length":3305,"saved":false}
{"contributors":[],"silentsave":false,"ts":1377479434499,"patch":[[{"diffs":[[0,"s();\r\n\r\n"],[1,"var gcm = require('./gcm');\r\n"],[0,"\r\nproces"]],"start1":219,"start2":219,"length1":16,"length2":45},{"diffs":[[0,";\r\n}\r\n\r\n"],[1,"app.post('/register', gcm.regist);\r\napp.post('/unregister', gcm.unregist);\r\napp.post('/send', gcm.send_push);\r\n\r\n"],[0,"//get ac"]],"start1":882,"start2":882,"length1":16,"length2":129},{"diffs":[[0,");\r\n"],[-1,"app.get('/list', routes.list);\r\n"],[0,"app."]],"start1":1078,"start2":1078,"length1":40,"length2":8},{"diffs":[[0,"oinMember);\r"],[1,"\napp.get('/favorites', routes.favorites);\r"],[0,"\n\r\n//post ac"]],"start1":1303,"start2":1303,"length1":24,"length2":66},{"diffs":[[0,"천 여부체크\r\n"],[-1,""],[0,"app.post"]],"start1":1985,"start2":1985,"length1":16,"length2":16},{"diffs":[[0,"/추천수 +1\r"],[1,"\napp.post('/appInsertFavorites', routes.appInsertFavorites);    //즐겨찾기 등록\r\napp.post('/appFavoritesList', routes.appFavoritesList);    //즐겨찾기 목록\r"],[0,"\n\r\nvar s"]],"start1":2061,"start2":2061,"length1":16,"length2":160}]],"length":3601,"saved":false}
